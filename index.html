<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Référence : Maladies, Ravageurs & Époques de nuisibilité</title>
  <style>
    body { font-family: system-ui, sans-serif; margin: 0; padding: 0; background:#f9f9f9; color:#333; }
    main { max-width: 90vw; margin: 2em auto; padding: 1em; background:#fff; border-radius: 8px; box-shadow:0 2px 8px rgba(0,0,0,0.1);}
    h1 { text-align:center; }
    label, select { font-size:1em; }
    select { padding: 0.3em 0.5em; }
    table { max-width:100%; border-collapse: collapse; margin:1em auto; }
    th, td { border:1px solid #ccc; padding: 0.5em; text-align:left; vertical-align: top; }
    th { background:#eee; position: sticky; top:0; }
    img { width: 100%; height: 100%; display: block; }
    .no-data { color: red; margin-top:1em; }
    footer { text-align:center; margin-top:2em; font-size:0.9em; color:#666; }
  </style>
</head>
<body>
  <main>
    <h1>Référence : Maladies, Ravageurs & Époques de nuisibilité</h1>
    <label>
      Choisir un tableau :
      <select id="choixTableau">
        <option value="">-- Sélectionner --</option>
        <option value="maladies">Tableau des maladies</option>
        <option value="ravageurs">Tableau des ravageurs</option>
        <option value="epoquesNuisibilite">Tableau des époques de nuisibilité</option>
      </select>
    </label>
    <div id="contenuTableau"></div>
  </main>
  <footer>© 2025 Ton Nom ou Organisation. Données hébergées sur GitHub Pages.</footer>

  <script>
    // ** Adapte ce chemin au nom exact de ton fichier JSON et à son emplacement **
    const JSON_PATH = 'data/tableaumaladiesravageurs.json';

    async function chargerDonnees() {
      try {
        const resp = await fetch(JSON_PATH);
        if (!resp.ok) throw new Error('Statut ' + resp.status);
        const data = await resp.json();
        console.log('JSON chargé:', data);
        return data;
      } catch (err) {
        console.error('Erreur de chargement JSON:', err);
        document.getElementById('contenuTableau').innerHTML =
          '<p class="no-data">Impossible de charger les données JSON. Vérifiez le chemin "' + JSON_PATH + '".</p>';
        return null;
      }
    }

    function genererTable(arrayObjets) {
      if (!Array.isArray(arrayObjets) || arrayObjets.length === 0) {
        return '<p class="no-data">Aucune donnée disponible pour ce tableau.</p>';
      }
      // Récupère toutes les clés à partir du premier objet
      const allKeys = Object.keys(arrayObjets[0]);
      // On exclut la clé "image" des colonnes normales, pour la traiter à part
      const keysSansImage = allKeys.filter(k => k !== 'image');
      let html = '<table><thead><tr>';
      keysSansImage.forEach(col => {
        // Éventuelle mise en forme du titre de colonne
        const titre = col.charAt(0).toUpperCase() + col.slice(1);
        html += `<th>${titre}</th>`;
      });
      html += '<th>Image</th></tr></thead><tbody>';
      arrayObjets.forEach(item => {
        html += '<tr>';
        keysSansImage.forEach(col => {
          let val = item[col];
          if (Array.isArray(val)) val = val.join(', ');
          else if (typeof val === 'object' && val !== null) val = JSON.stringify(val);
          html += `<td>${val != null ? val : ''}</td>`;
        });
        const imgPath = item.image;
        if (imgPath) {
          // On suppose que `item.image` est un chemin relatif comme "images/nom.jpg"
          html += `<td><img src="${imgPath}" alt="Image de ${item.nom||''}" onerror="this.style.display='none';"></td>`;
        } else {
          html += '<td></td>';
        }
        html += '</tr>';
      });
      html += '</tbody></table>';
      return html;
    }

    document.addEventListener('DOMContentLoaded', async () => {
      const select = document.getElementById('choixTableau');
      const conteneur = document.getElementById('contenuTableau');
      const data = await chargerDonnees();
      select.addEventListener('change', () => {
        conteneur.innerHTML = '';
        if (!data) {
          conteneur.innerHTML = '<p class="no-data">Données non chargées.</p>';
          return;
        }
        const valeur = select.value;
        if (!valeur) {
          conteneur.innerHTML = '';
          return;
        }
        if (valeur === 'maladies') {
          const arr = data.maladies;
          if (!Array.isArray(arr)) {
            console.error('Clé "maladies" introuvable dans JSON:', data);
            conteneur.innerHTML = '<p class="no-data">Erreur structure JSON : "maladies" introuvable.</p>';
          } else {
            conteneur.innerHTML = '<h2>Tableau des maladies</h2>' + genererTable(arr);
          }
        }
        else if (valeur === 'ravageurs') {
          const arr = data.ravageurs;
          if (!Array.isArray(arr)) {
            console.error('Clé "ravageurs" introuvable dans JSON:', data);
            conteneur.innerHTML = '<p class="no-data">Erreur structure JSON : "ravageurs" introuvable.</p>';
          } else {
            conteneur.innerHTML = '<h2>Tableau des ravageurs</h2>' + genererTable(arr);
          }
        }
        else if (valeur === 'epoquesNuisibilite') {
          const arr = data.epoquesNuisibilite;
          if (!Array.isArray(arr)) {
            console.error('Clé "epoquesNuisibilite" introuvable dans JSON:', data);
            conteneur.innerHTML = '<p class="no-data">Erreur structure JSON : "epoquesNuisibilite" introuvable.</p>';
          } else {
            conteneur.innerHTML = '<h2>Tableau des époques de nuisibilité</h2>' + genererTable(arr);
          }
        }
        else {
          conteneur.innerHTML = '<p class="no-data">Option inconnue.</p>';
        }
      });
    });
  </script>
</body>
</html>
